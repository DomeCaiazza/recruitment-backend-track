# Invoice Management API project

This is an invoice Management API project writen in laravel. It provides endpoints to manage users, tax profiles, and invoices. The project is structured using the MVC architecture and includes automated tests, Docker support, OpenAPI and postman documentaiont.

---

## Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Running Project](#running-project)
- [Testing the APIs](#testing-the-apis)
- [Features](#features)

## Overview

- **Purpose:** A REST API that manages users, tax profiles, and their related invoices.
- **Main Endpoints:**
  - `/users` – Manage users (API resource).
  - `/users/{user}/tax-profiles` – Manage tax profiles for each user.
  - `/users/{user}/tax-profiles/{tax_profile}/invoices` – Manage invoices for each tax profile.
- **Middleware:** Uses a middleware (`api.key`) to verify the API key for secure access.

---

## Prerequisites
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)
- [Docker Compose](https://docs.docker.com/compose/)
- [Laravel 11 + php8.3](https://laravel.com/docs/11.x/installation#installing-php)
- [Postman](https://www.postman.com/)

### Environment setup
1. **Clone the repository:**
```bash
 git clone git@github.com:DomeCaiazza/recruitment-backend-track.git
 cd recruitment-backend-track
 ```

2. **Set docker-compose and laravel environments:**
- copy or rename '.env.example' in '.env' changing the information within it as you wish (we will generate LARAVEL_APP_KEY later)
- from terminal go to the 'php-app' directory `cd php-app`
- give the command `composer install`
- give the command `php artisan key:generate --show` 
- copy the output of the terminal (generated key) into the ‘.env’ file by updating the value of 'LARAVEL_APP_KEY' variable.

Docker-compose (.env file) set this environment variables:
- MYSQL_ROOT_PASSWORD: mysql root password
- MYSQL_DATABASE: mysql database name
- MYSQL_USER: mysql user name
- MYSQL_PASSWORD: mysql user password
- MYSQL_TCP_PORT: mysql port
- LARAVEL_API_KEY: api key used to validate requests
- LARAVEL_API_KEY_TESTING: api key used to validate requests in testing environment
- LARAVEL_APP_KEY: laravel app key to encrypt data and secure requests

3. **Build and start the Docker containers:**
 ```bash
 docker-compose up --build
 ```
This command will create and start the necessary containers for the application:
- nginx web server
- application database
- application testing database
- php-fpm layer
- application database volume

After creation and start-up of the containers, the php service automatically migrates the db, performs the application tests on the testing db, and generates the OpenApi documentation.

---

## Running project
Once the containers are up and running, the application will be accessible at: http://localhost

### Docker-compose utilities commands
You can mannualy runs test with:
```bash
docker-compose exec -e 'DB_HOST=db-testing' php php artisan test
 ```
Database migration:
```bash
docker-compose exec php php artisan migrate
 ```

Create Seeds:
```bash
docker-compose exec php php artisan db:seed
 ```

Look at application logs:
```bash
docker-compose exec php tail -f storage/logs/laravel.log  
 ```


---

## Testing the APIs

You can test the API endpoints using tools like Postman.

### Import postman collections file

1. **Open Portmap application**
2. **Import this file:**
https://raw.githubusercontent.com/DomeCaiazza/recruitment-backend-track/refs/heads/main/php_app.postman_doc.json

### OpenAPI
Documentation link available after application start-up: [http://localhost/api/documentation/](http://localhost/api/documentation/)

---

## Features
- User Management: Full CRUD operations via API endpoints.
- Tax Profiles: Associate tax profiles with users, each tax profile has the combination of vat_number and unique tax_code.
- Invoices: Manage invoices for each tax profile, the invoice_number and total are autogenerated.
- Security: Protected endpoints using an API key middleware.